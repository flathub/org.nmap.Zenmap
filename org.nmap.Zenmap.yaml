app-id: org.nmap.Zenmap
runtime: org.gnome.Platform
sdk: org.gnome.Sdk
runtime-version: '46'
command: zenmap

finish-args:
  - --socket=x11
  - --share=ipc
  - --share=network
  - --filesystem=home
  - --env=TMPDIR=/var/tmp

cleanup:
  - /man
  - /include
  - /share/man
  - /share/doc
  - /lib/*.a
  - /lib/*.la

modules:

  # --- python-build ---
  - name: python-build
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --no-build-isolation --prefix="${FLATPAK_DEST}"
        .
    cleanup: ['*']
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/ce/9e/2d725d2f7729c6e79ca62aeb926492abbc06e25910dd30139d60a68bcb19/build-1.2.1.tar.gz
        sha256: 526263f4870c26f26c433545579475377b2b7588b6f1eac76a001e873ae3e19d

  - name: zenmap
    buildsystem: autotools
    sources:
      - type: archive
        url: https://nmap.org/dist/nmap-7.95.tar.bz2
        sha256: e14ab530e47b5afd88f1c8a2bac7f89cd8fe6b478e22d255c5b9bddb7a1c5778
        x-checker-data:
          type: anitya
          project-id: 2096
          url-template: https://nmap.org/dist/nmap-$version.tar.bz2
      - type: patch
        path: dialog.patch

  - name: metadata
    buildsystem: simple
    build-commands:
      - install -Dm 644 org.nmap.Zenmap.metainfo.xml -t /app/share/metainfo/
      - install -Dm 644 org.nmap.Zenmap.desktop -t /app/share/applications/
      - install -Dm 644 org.nmap.Zenmap.64.png /app/share/icons/hicolor/64x64/apps/org.nmap.Zenmap.png
      - install -Dm 644 org.nmap.Zenmap.128.png /app/share/icons/hicolor/128x128/apps/org.nmap.Zenmap.png
      - install -Dm 644 org.nmap.Zenmap.256.png /app/share/icons/hicolor/256x256/apps/org.nmap.Zenmap.png
    sources:
      - type: file
        path: org.nmap.Zenmap.metainfo.xml
      - type: file
        path: org.nmap.Zenmap.64.png
      - type: file
        path: org.nmap.Zenmap.128.png
      - type: file
        path: org.nmap.Zenmap.256.png
      - type: file
        path: org.nmap.Zenmap.desktop

